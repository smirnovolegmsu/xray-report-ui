<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Xray Admin Panel</title>

<!-- Chart Libraries -->
<script src="https://cdn.amcharts.com/lib/5/index.js"></script>
<script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
<script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
<script src="https://cdn.amcharts.com/lib/5/themes/Dark.js"></script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts@3.44.0/dist/apexcharts.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6.17/dist/plot.umd.min.js"></script>
<script>
// Check Observable Plot after load
window.addEventListener('load', function() {
  console.log('üîç Checking Observable Plot availability...');
  console.log('typeof Plot:', typeof Plot);
  if (typeof Plot !== 'undefined' && typeof Plot.plot === 'function') {
    if (typeof window.Plot === 'undefined') {
      window.Plot = Plot;
    }
    console.log('‚úÖ Observable Plot loaded successfully!');
  } else {
    console.error('‚ùå Observable Plot failed to load!');
  }
});
</script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vega@5.22.1/build/vega.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@5.6.1/build/vega-lite.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@6.21.0/build/vega-embed.min.js"></script>

<!-- Application Styles -->
<link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>

<div class="header">
  <div class="header-left">
    <div class="logo">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
      <span>Xray Usage</span>
    </div>
    <div class="status-badges-compact">
      <div class="badge-compact badge-clickable" id="badgeUI" title="UI —Å–µ—Ä–≤–∏—Å">
        <span class="dot" id="dotUI"></span>
        <span>UI:</span>
      </div>
      <div class="badge-compact badge-clickable" id="badgeXray" title="Xray —Å–µ—Ä–≤–∏—Å">
        <span class="dot" id="dotXray"></span>
        <span>Xray:</span>
      </div>
      <div class="badge-compact badge-clickable" id="badgeCollector" title="–°–±–æ—Ä—â–∏–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏">
        <span class="dot" id="dotCollector"></span>
        <span>–°–±–æ—Ä—â–∏–∫</span>
      </div>
    </div>
  </div>
  
  <!-- Main Navigation Tabs -->
  <div class="header-nav">
    <div class="tabs">
      <div class="tab active" data-tab="dashboard">üìä <span data-i18n="dashboard">–û–±–∑–æ—Ä</span></div>
      <div class="tab" data-tab="users">üë• <span data-i18n="users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span></div>
      <div class="tab" data-tab="system">‚öôÔ∏è <span>–°–∏—Å—Ç–µ–º–∞</span></div>
    </div>
  </div>
  
  <div class="header-right">
    <!-- DateSelect -->
    <select id="dateSelect" title="–î–∞—Ç–∞ –æ—Ç—á—ë—Ç–∞" style="width:150px;"></select>
    
    <!-- Segmented: Daily/Cumulative -->
    <div class="seg" title="–†–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–æ–≤">
      <button id="segDaily" class="active">üìà Daily</button>
      <button id="segCum">üìä Cumulative</button>
    </div>
    
    <!-- Segmented: Dark/Light -->
    <div class="seg" title="–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è">
      <button id="segDark" class="active">üåô</button>
      <button id="segLight">‚òÄÔ∏è</button>
    </div>
    
    <!-- Nav pills: –û–Ω–ª–∞–π–Ω -->
    <div class="nav-pills">
      <button class="nav-pill" id="navOnline" data-nav="online">‚ö° –û–Ω–ª–∞–π–Ω</button>
    </div>
    
    <!-- Overview Metric Filter -->
    <div class="seg" id="overviewMetricFilter" title="–§–∏–ª—å—Ç—Ä –¥–∞–Ω–Ω—ã—Ö" style="display: none; gap: 4px;">
      <button id="btnOverviewTraffic" class="active">üìä Traffic</button>
      <button id="btnOverviewConns">üîå Connections</button>
    </div>
    
    <!-- Chart Library Toggle -->
    <div class="seg" title="–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –≥—Ä–∞—Ñ–∏–∫–æ–≤" style="display: flex; flex-wrap: wrap; gap: 4px;">
      <button id="btnChartAmCharts" class="active">üìä amCharts</button>
      <button id="btnChartApex">üìà ApexCharts</button>
      <button id="btnChartObservable">ü•á Observable</button>
      <button id="btnChartHighcharts">ü•à Highcharts</button>
      <button id="btnChartVegaLite">ü•â Vega-Lite</button>
      <button id="btnChartRecharts">üìä Recharts</button>
    </div>
  </div>
</div>

<div class="container">

  <!-- –£–ü–†–ê–í–õ–ï–ù–ò–ï (–ò—Å—Ç–æ—Ä–∏—è) -->
  <div class="pane active" data-pane="management" id="paneManagement">
    <!-- KPIRow: 6 –∫–∞—Ä—Ç–æ—á–µ–∫ -->
    <div class="kpi-row" id="kpiRow">
      <div class="kpi-card stat-card" id="kpiTodayTraffic">
        <div class="kpi-title">Today traffic (GB)</div>
        <div class="kpi-value" id="kpiTodayTrafficValue">‚Äî</div>
        <div class="kpi-subline">avg7d: <span id="kpiTodayTrafficAvg">‚Äî</span></div>
        <div class="kpi-bubble" id="kpiTodayTrafficBubble"></div>
      </div>
      
      <div class="kpi-card stat-card" id="kpiTodayConns">
        <div class="kpi-title">Today conns</div>
        <div class="kpi-value" id="kpiTodayConnsValue">‚Äî</div>
        <div class="kpi-subline">avg7d: <span id="kpiTodayConnsAvg">‚Äî</span></div>
        <div class="kpi-bubble" id="kpiTodayConnsBubble"></div>
      </div>
      
      <div class="kpi-card total-card" id="kpiTotal7dTraffic">
        <div class="kpi-title">7d total traffic (GB)</div>
        <div class="kpi-value" id="kpiTotal7dTrafficValue">‚Äî</div>
        <div class="kpi-bubble" id="kpiTotal7dTrafficBubble"></div>
      </div>
      
      <div class="kpi-card total-card" id="kpiTotal7dConns">
        <div class="kpi-title">7d total conns</div>
        <div class="kpi-value" id="kpiTotal7dConnsValue">‚Äî</div>
        <div class="kpi-bubble" id="kpiTotal7dConnsBubble"></div>
      </div>
      
      <div class="kpi-card top-card" id="kpiTopDomainsTraffic">
        <div class="kpi-title">Top domains (7d) ‚Äî traffic (top-3)</div>
        <div class="kpi-list" id="kpiTopDomainsTrafficList"></div>
        <div class="kpi-bubble" id="kpiTopDomainsTrafficBubble"></div>
      </div>
      
      <div class="kpi-card top-card" id="kpiTopDomainsConns">
        <div class="kpi-title">Top domains (7d) ‚Äî conns (top-3)</div>
        <div class="kpi-list" id="kpiTopDomainsConnsList"></div>
        <div class="kpi-bubble" id="kpiTopDomainsConnsBubble"></div>
      </div>
    </div>
    
    <!-- Main Content Layout -->
    <div class="main-content-layout">
      <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
      <div class="left-column">
        <div class="card left-panel-card">
          <div class="card-hd">
            <div>
              <h2>–¢—Ä–µ–Ω–¥—ã (7 –¥–Ω–µ–π) & –¢–æ–ø –¥–æ–º–µ–Ω—ã (7 –¥–Ω–µ–π) & –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h2>
              <div class="meta">–ü–µ—Ä–µ–∫–ª—é—á–∞–π –≤ —à–∞–ø–∫–µ: Daily / Cumulative</div>
            </div>
          </div>
          <div class="card-bd left-panel-content">
            <div class="trends-vertical-item">
              <div class="chartbox">
                <div id="chTraffic" style="width:100%;height:100%;"></div>
              </div>
              <div class="chartbox">
                <div id="chConns" style="width:100%;height:100%;"></div>
              </div>
            </div>
            
            <div class="domains-vertical-item">
              <div class="domains-single-table">
                <div class="kpi-title">–ü–æ —Ç—Ä–∞—Ñ–∏–∫—É</div>
                <div class="table-container">
                  <table class="table" id="tblTopTraffic">
                    <thead>
                      <tr>
                        <th>Domain</th>
                        <th>GB/MB</th>
                        <th>%</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
              <div class="domains-single-table">
                <div class="kpi-title">–ü–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º</div>
                <div class="table-container">
                  <table class="table" id="tblTopConns">
                    <thead>
                      <tr>
                        <th>Domain</th>
                        <th>#</th>
                        <th>%</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
            
            <div class="histogram-vertical-item">
              <div class="chartbox">
                <div class="kpi-title">–ü–æ —Ç—Ä–∞—Ñ–∏–∫—É</div>
                <div id="chUsersTraffic" style="width:100%;height:100%;"></div>
              </div>
              <div class="chartbox">
                <div class="kpi-title">–ü–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º</div>
                <div id="chUsersConns" style="width:100%;height:100%;"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
      <div class="right-column">
        <div class="card right-panel-card">
          <div class="card-hd">
            <div>
              <h2>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
              <div class="meta">–§–∏–ª—å—Ç—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è</div>
            </div>
            <div class="users-controls-row">
              <div class="filters-inline" id="userFilters"></div>
            </div>
          </div>
          <div class="card-bd right-panel-content">
            <div class="users-grid" id="usersGrid"></div>
          </div>
          <div class="notice" id="usersNotice" style="display:none"></div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- –û–ù–õ–ê–ô–ù -->
  <div class="pane" data-pane="online" id="paneOnline">
    <div class="card">
      <div class="card-hd">
        <div>
          <h2>–û–Ω–ª–∞–π–Ω</h2>
          <div class="meta" id="onlineMeta">–ò—Å—Ç–æ—á–Ω–∏–∫: <span id="onlineSource">‚Äî</span></div>
        </div>
        <div class="row">
          <div class="seg" title="Scope">
            <button id="segScopeGlobal" class="active">Global</button>
            <button id="segScopeUsers">By users</button>
          </div>
          <div class="seg" title="–ú–µ—Ç—Ä–∏–∫–∞">
            <button id="segMetricTraffic" class="">Traffic</button>
            <button id="segMetricConns" class="active">Conns</button>
            <button id="segMetricOnline">Online users</button>
          </div>
          <div class="seg" title="–ü–µ—Ä–∏–æ–¥">
            <button id="segPeriod60m" class="active">60m</button>
            <button id="segPeriod6h">6h</button>
            <button id="segPeriod24h">24h</button>
          </div>
          <div class="seg" title="–ì—Ä–∞–Ω—É–ª—è—Ä–Ω–æ—Å—Ç—å">
            <button id="segGran1m">1m</button>
            <button id="segGran5m" class="active">5m</button>
            <button id="segGran10m">10m</button>
          </div>
          <button class="btn" id="btnPause">Pause</button>
        </div>
      </div>
      <div class="card-bd">
        <div class="online-now" id="onlineNow">
          <div class="kpi-card">
            <div class="kpi-title">Online users</div>
            <div class="kpi-value" id="onlineUsersValue">‚Äî</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-title">Connections</div>
            <div class="kpi-value" id="onlineConnsValue">‚Äî</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-title">Traffic</div>
            <div class="kpi-value" id="onlineTrafficValue">‚Äî</div>
            <div class="kpi-subline" id="onlineTrafficNote" style="display:none;">Traffic unavailable</div>
          </div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
          <div class="chartbox" style="position: relative;">
            <div class="kpi-title" style="position: absolute; top: 4px; left: 4px; right: 4px; z-index: 10; font-size: 13px; margin: 0; padding: 0;">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è</div>
            <div id="chOnlineConns" style="width:100%;height:100%;"></div>
          </div>
          <div class="chartbox" style="position: relative;">
            <div class="kpi-title" style="position: absolute; top: 4px; left: 4px; right: 4px; z-index: 10; font-size: 13px; margin: 0; padding: 0;">–¢—Ä–∞—Ñ–∏–∫</div>
            <div id="chOnlineTraffic" style="width:100%;height:100%;"></div>
          </div>
        </div>
        <div class="card">
          <h3>Top users (—Å–µ–≥–æ–¥–Ω—è)</h3>
          <table class="table" id="tblOnlineTop">
            <thead>
              <tr>
                <th>User</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–¢—Ä–∞—Ñ–∏–∫</th>
                <th>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  
  <!-- –°–ò–°–¢–ï–ú–ê -->
  <div class="pane" data-pane="system" id="paneSystem">
    <!-- Internal Navigation Tabs -->
    <div class="system-nav">
      <div class="seg system-seg">
        <button class="system-tab active" data-system-tab="services">‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏</button>
        <button class="system-tab" data-system-tab="events">üìã –°–æ–±—ã—Ç–∏—è</button>
        <button class="system-tab" data-system-tab="settings">üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
      </div>
    </div>
    
    <!-- Services Sub-pane -->
    <div class="system-subpane active" data-system-subpane="services">
    <div class="card">
      <h3 class="card-title">
        <span>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏</span>
        <span class="help" data-tip="–°—Ç–∞—Ç—É—Å, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∏ –ª–æ–≥–∏ systemd">?</span>
      </h3>
      <div class="card-desc" style="margin-bottom: 16px;">
        –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏ —á–µ—Ä–µ–∑ systemd. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Xray —Ä–∞–∑–æ—Ä–≤—ë—Ç –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ VPN –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.
      </div>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 16px;">
        <!-- UI Service Card -->
        <div style="padding: 16px; background: var(--panel2); border-radius: 8px; border: 1px solid var(--line);">
          <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 14px;">
            <div>
              <div style="font-weight: 600; font-size: 16px; margin-bottom: 4px;">üìã UI Service</div>
              <div style="font-size: 13px; color: var(--muted);">–í–µ–±-–ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</div>
            </div>
            <div id="serviceUIStatus" style="font-size: 13px;">
              <span class="dot" id="serviceUIDot" style="width: 10px; height: 10px; border-radius: 50%; background: var(--muted); display: inline-block; margin-right: 8px;"></span>
              <span id="serviceUIStatusText">‚Äî</span>
            </div>
          </div>
          
          <div style="margin-bottom: 14px; padding: 12px; background: var(--bg); border-radius: 6px; font-size: 13px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
              <span style="color: var(--muted);">–°–µ—Ä–≤–∏—Å:</span>
              <code style="font-size: 12px; color: var(--text);">xray-report-ui</code>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
              <span style="color: var(--muted);">–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:</span>
              <strong id="serviceUIUptime" style="color: var(--text); font-size: 13px;">‚Äî</strong>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: var(--muted);">–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤ (14 –¥–Ω–µ–π):</span>
              <strong id="serviceUIRestarts" style="color: var(--text); font-size: 13px;">‚Äî</strong>
            </div>
          </div>
          
          <div style="display: flex; gap: 8px; margin-bottom: 14px;">
            <button class="btn" id="btnRestartUI" style="flex: 1; padding: 10px; font-size: 13px;">üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å</button>
          </div>
          
          <div id="serviceUILogs" style="margin-top: 14px; padding-top: 14px; border-top: 1px solid var(--line);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
              <div style="font-size: 13px; color: var(--muted);">
                –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤:
              </div>
              <button class="btn" onclick="loadServiceJournal('ui')" style="padding: 6px 10px; font-size: 12px;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>
            <pre id="serviceUIJournalContent" style="max-height:300px;overflow:auto;font-size:12px;font-family:ui-monospace,Menlo,Consolas,monospace;background:var(--bg);padding:12px;border-radius:6px;border:1px solid var(--line);white-space:pre-wrap;word-wrap:break-word;color:var(--text);">–ó–∞–≥—Ä—É–∑–∫–∞...</pre>
          </div>
          
          <div style="margin-top: 14px; padding-top: 14px; border-top: 1px solid var(--line);">
            <div style="font-size: 13px; font-weight: 600; margin-bottom: 8px; color: var(--text);">–ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤:</div>
            <div id="serviceUIRestartHistory" style="font-size: 12px; color: var(--muted);">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
          </div>
        </div>
        
        <!-- Xray Service Card -->
        <div style="padding: 16px; background: var(--panel2); border-radius: 8px; border: 1px solid var(--line);">
          <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 14px;">
            <div>
              <div style="font-weight: 600; font-size: 16px; margin-bottom: 4px;">‚ö° Xray Service</div>
              <div style="font-size: 13px; color: var(--muted);">VPN —Å–µ—Ä–≤–µ—Ä</div>
            </div>
            <div id="serviceXrayStatus" style="font-size: 13px;">
              <span class="dot" id="serviceXrayDot" style="width: 10px; height: 10px; border-radius: 50%; background: var(--muted); display: inline-block; margin-right: 8px;"></span>
              <span id="serviceXrayStatusText">‚Äî</span>
            </div>
          </div>
          
          <div style="margin-bottom: 14px; padding: 12px; background: var(--bg); border-radius: 6px; font-size: 13px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
              <span style="color: var(--muted);">–°–µ—Ä–≤–∏—Å:</span>
              <code id="serviceXrayName" style="font-size: 12px; color: var(--text);">xray</code>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
              <span style="color: var(--muted);">–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:</span>
              <strong id="serviceXrayUptime" style="color: var(--text); font-size: 13px;">‚Äî</strong>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: var(--muted);">–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤ (14 –¥–Ω–µ–π):</span>
              <strong id="serviceXrayRestarts" style="color: var(--text); font-size: 13px;">‚Äî</strong>
            </div>
          </div>
          
          <div style="display: flex; gap: 8px; margin-bottom: 14px;">
            <button class="btn danger" id="btnRestartXray" style="flex: 1; padding: 10px; font-size: 13px;">‚ö° –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å</button>
          </div>
          
          <div id="serviceXrayLogs" style="margin-top: 14px; padding-top: 14px; border-top: 1px solid var(--line);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
              <div style="font-size: 13px; color: var(--muted);">
                –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤:
              </div>
              <button class="btn" onclick="loadServiceJournal('xray')" style="padding: 6px 10px; font-size: 12px;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>
            <pre id="serviceXrayJournalContent" style="max-height:300px;overflow:auto;font-size:12px;font-family:ui-monospace,Menlo,Consolas,monospace;background:var(--bg);padding:12px;border-radius:6px;border:1px solid var(--line);white-space:pre-wrap;word-wrap:break-word;color:var(--text);">–ó–∞–≥—Ä—É–∑–∫–∞...</pre>
          </div>
          
          <div style="margin-top: 14px; padding-top: 14px; border-top: 1px solid var(--line);">
            <div style="font-size: 13px; font-weight: 600; margin-bottom: 8px; color: var(--text);">–ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤:</div>
            <div id="serviceXrayRestartHistory" style="font-size: 12px; color: var(--muted);">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Events Sub-pane -->
  <div class="system-subpane" data-system-subpane="events">
    <div class="card">
      <h3 class="card-title">
        <span data-i18n="eventLog">–ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π</span>
        <span class="help" data-tip="–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ –ø–∞–Ω–µ–ª–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è">?</span>
      </h3>
      <div class="card-desc" data-i18n="eventsDesc">
        –ñ—É—Ä–Ω–∞–ª –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –≤ –ø–∞–Ω–µ–ª–∏.
      </div>
      
      <div class="form-row">
        <input type="text" id="eventsFilter" placeholder="–ü–æ–∏—Å–∫..." style="flex:1;max-width:300px;">
        <button class="btn" id="btnRefreshEvents">üîÑ <span data-i18n="refresh">–û–±–Ω–æ–≤–∏—Ç—å</span></button>
      </div>

      <div class="table-wrap">
        <table id="eventsTable">
          <thead>
            <tr>
              <th data-i18n="time">–í—Ä–µ–º—è</th>
              <th data-i18n="type">–¢–∏–ø</th>
              <th data-i18n="action">–î–µ–π—Å—Ç–≤–∏–µ</th>
              <th data-i18n="details">–î–µ—Ç–∞–ª–∏</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>
  
  <!-- Settings Sub-pane -->
  <div class="system-subpane" data-system-subpane="settings">
      <div class="card">
        <h3 class="card-title">
          <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Xray/Reality</span>
          <span class="help" data-tip="–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ VLESS-—Å—Å—ã–ª–æ–∫">?</span>
        </h3>
        
        <div style="margin-bottom: 20px;">
          <label style="font-size: 12px; color: var(--muted); margin-bottom: 8px; display: block; font-weight: 600;">–†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:</label>
          <div style="display: flex; gap: 12px; align-items: flex-end; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 200px;">
              <label style="font-size: 11px; color: var(--muted); margin-bottom: 4px; display: block;">
                Server Host <span class="help" data-tip="IP-–∞–¥—Ä–µ—Å –∏–ª–∏ –¥–æ–º–µ–Ω –≤–∞—à–µ–≥–æ VPN —Å–µ—Ä–≤–µ—Ä–∞">?</span>
              </label>
              <input type="text" id="setServerHost" placeholder="123.45.67.89 –∏–ª–∏ vpn.example.com" style="width: 100%; padding: 6px; font-size: 13px;">
            </div>
            <div style="flex: 1; min-width: 200px;">
              <label style="font-size: 11px; color: var(--muted); margin-bottom: 4px; display: block;">
                Reality PBK (override) <span class="help" data-tip="–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á Reality">?</span>
              </label>
              <input type="text" id="setPbk" placeholder="(–∞–≤—Ç–æ)" style="width: 100%; padding: 6px; font-size: 13px;">
            </div>
            <div style="flex: 1; min-width: 200px;">
              <label style="font-size: 11px; color: var(--muted); margin-bottom: 4px; display: block;">
                CSV –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è <span class="help" data-tip="–ü—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å CSV-–æ—Ç—á—ë—Ç–∞–º–∏">?</span>
              </label>
              <input type="text" id="setUsageDir" placeholder="/var/log/xray/usage" style="width: 100%; padding: 6px; font-size: 13px;">
            </div>
            <div style="display: flex; gap: 6px; flex-shrink: 0;">
              <button class="btn primary" id="btnSaveSettings" style="padding: 6px 12px; font-size: 13px;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
              <button class="btn" id="btnReloadSettings" style="padding: 6px 12px; font-size: 13px;">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            </div>
          </div>
        </div>

        <div style="margin-bottom: 20px;">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
            <label style="font-size: 12px; color: var(--muted); font-weight: 600;">–¢–µ–∫—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã Reality:</label>
            <button class="btn" id="btnReloadXray" style="padding: 4px 8px; font-size: 12px;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
          </div>
          <pre id="realityParams" class="mono" style="background:var(--panel2);padding:8px;border-radius:6px;overflow-x:auto;font-size:11px;max-height:120px;overflow-y:auto;"></pre>
        </div>

        <div>
          <label style="font-size: 12px; color: var(--muted); margin-bottom: 4px; display: block; font-weight: 600;">–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Xray (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ):</label>
          <div class="card-desc" style="margin-bottom: 8px; font-size: 12px;">
            –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞ Xray.
          </div>
          <textarea id="xrayConfig" readonly style="min-height: 200px; font-size: 11px; width: 100%; font-family: monospace;"></textarea>
        </div>
      </div>

      <div class="card" style="margin-top: 16px;">
        <h3 class="card-title">Collector (—Å–±–æ—Ä—â–∏–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏)</h3>
        <div id="collectorStatus"></div>
      </div>
    </div>
  </div>
  </div>
  
  <!-- –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò -->
  <div class="pane" data-pane="users">
    <div class="card">
      <div class="card-hd">
        <div>
          <h3 class="card-title">
            <span data-i18n="usersManagement">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</span>
            <span class="help" data-tip="–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ Xray config">?</span>
          </h3>
          <div class="card-desc" data-i18n="usersDesc">
            –ó–¥–µ—Å—å –ø–æ–∫–∞–∑–∞–Ω—ã –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ Xray.
          </div>
        </div>
        <div class="btn-group" style="flex-shrink: 0; margin-left: 16px;">
          <button class="btn primary" id="btnAddUser">‚ûï <span data-i18n="addUser">–î–æ–±–∞–≤–∏—Ç—å</span></button>
          <button class="btn" id="btnRefreshUsers">üîÑ <span data-i18n="refresh">–û–±–Ω–æ–≤–∏—Ç—å</span></button>
        </div>
      </div>

      <div class="table-wrap">
        <table id="usersTable">
          <thead>
            <tr>
              <th data-i18n="name">–ò–º—è/Alias</th>
              <th>UUID</th>
              <th>–¢–û–ü-3 –¥–æ–º–µ–Ω–∞</th>
              <th>–î–Ω–µ–π –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</th>
              <th>–°—É–º–º–∞—Ä–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫</th>
              <th>–°—Ç–∞—Ç—É—Å</th>
              <th data-i18n="actions">–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

</div>

<!-- Modal -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <h3 id="modalTitle">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
    <p id="modalText" class="muted"></p>
    <div id="modalInput"></div>
    <div class="modal-actions">
      <button class="btn" id="modalCancel">–û—Ç–º–µ–Ω–∞</button>
      <button class="btn danger" id="modalConfirm">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast">
  <div class="toast-title" id="toastTitle"></div>
  <div class="toast-text" id="toastText"></div>
</div>

<!-- Application Scripts -->
<script src="/static/js/i18n.js"></script>
<script src="/static/js/utils.js"></script>
<script src="/static/js/theme.js"></script>
<script src="/static/js/state.js"></script>
<script src="/static/js/management.js"></script>
<script src="/static/js/online.js"></script>
<script src="/static/js/users.js"></script>
<script src="/static/js/events.js"></script>
<script src="/static/js/settings.js"></script>
<script src="/static/js/collector.js"></script>
<script src="/static/js/system.js"></script>
<script src="/static/js/init.js"></script>

</body>
</html>
